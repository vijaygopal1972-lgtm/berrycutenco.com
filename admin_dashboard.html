<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Order Dashboard - BerryCuteNCo</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background-color: #f7f9fb;
            font-family: 'Inter', sans-serif;
        }

        .status-pill-Pending {
            background-color: #fca5a5;
            color: #7f1d1d;
        }
        .status-pill-Processing {
            background-color: #fcd34d;
            color: #92400e;
        }
        .status-pill-Delivered {
            background-color: #a7f3d0;
            color: #065f46;
        }
    </style>
</head>

<body class="min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="mb-8 p-4 bg-white rounded-xl shadow-lg flex justify-between items-center">
            <h1 class="text-3xl font-bold text-gray-800">Admin Dashboard</h1>
            <div id="auth-status" class="text-sm font-medium text-blue-600">Connecting…</div>
        </header>

        <main>
            <section id="orders-list-section" class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Current Orders</h2>

                <div id="orders-list" class="space-y-4">
                    <p id="initial-loading-message"
                       class="text-gray-500 text-center p-8 bg-white rounded-xl shadow-md">
                       Fetching orders...
                    </p>
                </div>
            </section>
        </main>

        <footer class="text-center text-gray-500 text-sm mt-12 p-4">
            Ⓒ BerryCuteNCo — Realtime Admin Dashboard
        </footer>
    </div>

    <!-- Firebase Admin Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getFirestore,
            collection,
            doc,
            updateDoc,
            onSnapshot,
            query,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // DOM references
        const ordersListEl = document.getElementById("orders-list");
        const authStatus = document.getElementById("auth-status");
        const initialLoadingMessage = document.getElementById("initial-loading-message");

        // ⭐⭐⭐ IMPORTANT: ENTER YOUR FIREBASE CONFIG HERE ⭐⭐⭐
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "berrycutenco.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "berrycutenco.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        let db;

        function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);

                authStatus.textContent = "Connected to Firebase ✔️";
                startOrderListener();

            } catch (err) {
                console.error("Firebase Init Error:", err);
                authStatus.textContent = "❌ Firebase Error — check console";
            }
        }

        function startOrderListener() {
            const ordersRef = collection(db, "orders");
            const q = query(ordersRef);

            onSnapshot(
                q,
                (snapshot) => {
                    ordersListEl.innerHTML = "";
                    initialLoadingMessage?.remove();

                    if (snapshot.empty) {
                        ordersListEl.innerHTML =
                            `<p class="text-center text-gray-500 bg-white p-6 rounded-lg shadow">
                                No orders yet.
                             </p>`;
                        return;
                    }

                    snapshot.forEach((docSnap) => {
                        const order = docSnap.data();
                        const id = docSnap.id;
                        renderOrder(order, id);
                    });

                    document.querySelectorAll(".status-update-btn").forEach((btn) =>
                        btn.addEventListener("click", updateStatus)
                    );
                },
                (error) => {
                    console.error(error);
                    ordersListEl.innerHTML =
                        `<p class="text-red-600 text-center p-4">Error loading orders.</p>`;
                }
            );
        }

        function renderOrder(order, id) {
            const div = document.createElement("div");
            const status = order.status || "Pending";
            const date = order.createdAt?.seconds
                ? new Date(order.createdAt.seconds * 1000).toLocaleString()
                : "N/A";

            const address = `
                ${order.address || ""}<br>
                ${order.city || ""} - ${order.pincode || ""}<br>
                ${order.landmark || ""}
            `;

            div.className =
                "bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300";

            div.innerHTML = `
                <div class="flex justify-between items-start border-b pb-2 mb-3">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">Order ID: ${id}</h3>
                        <p class="text-xs text-gray-500">Amount: ₹${order.amountPaid}</p>
                        <p class="text-xs text-gray-500">Payment ID: ${order.paymentId || "N/A"}</p>
                    </div>
                    <span class="px-3 py-1 text-xs font-bold rounded-full status-pill-${status}">
                        ${status}
                    </span>
                </div>

                <p class="text-sm text-gray-700"><strong>Name:</strong> ${order.name}</p>
                <p class="text-sm text-gray-700"><strong>Email:</strong> ${order.email}</p>
                <p class="text-sm text-gray-700"><strong>Phone:</strong> ${order.mobile}</p>

                <p class="text-xs text-gray-500 mt-2">
                    <strong>Address:</strong><br>${address}
                </p>

                <p class="text-xs text-gray-500 mt-2">
                    <strong>Placed:</strong> ${date}
                </p>

                <div class="flex gap-2 mt-4 pt-4 border-t">
                    <button class="status-update-btn bg-red-200 text-red-800 px-3 py-1 text-xs rounded"
                            data-id="${id}" data-status="Pending">
                        Set Pending
                    </button>

                    <button class="status-update-btn bg-yellow-300 text-yellow-900 px-3 py-1 text-xs rounded"
                            data-id="${id}" data-status="Processing">
                        Set Processing
                    </button>

                    <button class="status-update-btn bg-green-300 text-green-900 px-3 py-1 text-xs rounded"
                            data-id="${id}" data-status="Delivered">
                        Set Delivered
                    </button>
                </div>
            `;

            ordersListEl.appendChild(div);
        }

        async function updateStatus(event) {
            const orderId = event.target.dataset.id;
            const newStatus = event.target.dataset.status;

            const docRef = doc(db, "orders", orderId);

            try {
                await updateDoc(docRef, {
                    status: newStatus,
                    updatedAt: serverTimestamp()
                });

            } catch (err) {
                console.error("Update error:", err);
                alert("Could not update status!");
            }
        }

        window.onload = initFirebase;
    </script>

</body>
</html>
